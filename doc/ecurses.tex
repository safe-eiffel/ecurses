%% This LaTeX-file was created by <pgc> Fri Oct 15 20:50:52 1999
%% LyX 0.12 (C) 1995-1998 by Matthias Ettrich and the LyX Team

%% Do not edit this file unless you know what you are doing.
\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}

\makeatletter


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\newcommand{\LyX}{L\kern-.1667em\lower.25em\hbox{Y}\kern-.125emX\spacefactor1000}
\newcommand{\noun}[1]{\textsc{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
\newenvironment{lyxlist}[1]
  {\begin{list}{}
    {\settowidth{\labelwidth}{#1}
     \setlength{\leftmargin}{\labelwidth}
     \addtolength{\leftmargin}{\labelsep}
     \renewcommand{\makelabel}[1]{##1 \hfill}}}
  {\end{list}}
\newenvironment{lyxcode}
  {\begin{list}{}{
    \setlength{\rightmargin}{\leftmargin}
    \raggedright
    \setlength{\itemsep}{0pt}
    \setlength{\parsep}{0pt}
    \ttfamily}%
   \item[]}
  {\end{list}}

\makeatother

\begin{document}


\title{ECurses : an Eiffel binding to Curses}


\author{Paul G. Crismer, Eric Fafchamps \\
<pgcrism@attglobal.net>, <eric.fafchamps@win.be>}


\date{October 3, 1999}

\maketitle
\begin{abstract}
ECurses is an Eiffel binding to Curses. It tries to be more than just a wrapping
of the C library. It does not implement all the features of Curses, but provides
enough functionality to allow development of nice console applications.

ECurses has been designed to be portable among different platforms, i.e. on
\noun{Unix/Linux} (Curses, NCurses) and \noun{Windows} (PDCurses).
\end{abstract}

\section{Introduction}

ECurses is an Eiffel binding to Curses. It is intended to be sufficiently complete
to enable people write terminal/console applications in Eiffel.

The following table gives an overview of what ECurses provides, compared to
the Curses library.

\vspace{0.3cm}
{\centering \begin{tabular}{|l|l|l|}
\hline 
Curses&
ECurses&
Eiffel Class\\
\hline 
\hline 
Curses core&
Partial&
CURSES\_WINDOW\\
{*} color&
Yes&
\\
{*} character attributes&
Yes&
\\
{*} subwindows&
Yes&
\\
{*} scrolling&
Yes&
\\
{*} mouse interfacing&
No&
\\
{*} multiple terminal screens&
No&
\\
{*} testing for terminal capabilities&
No&
\\
\hline 
Pads&
Partial&
CURSES\_PAD\\
\hline 
Soft label keys&
Yes&
CURSES\_SOFT\_LABEL\_KEYS\\
\hline 
Panels&
Yes&
CURSES\_PANEL\\
\hline 
Menu&
No&
\\
\hline 
Forms&
No&
\\
\hline 
\end{tabular}\par}
\vspace{0.3cm}

ECurses introduces some level of abstraction. Feature names try to be more explicit
than their Curses counterpart. When possible pre- and post-conditions reflect
the features specifications.

ECurses has not been ``extensively'' tested. Though, it works sufficiently
well to develop applications with color, scrolling, multiple panels, and basic
forms.

This document is \emph{not} a Curses manual. Please refer to appropriate man
pages or to the excellent article ``Writing programs with NCURSES'' by Eric
S. Raymond and Zeyd M. Ben-Halim.


\section{Installation}


\subsection{Unpack directory structure}

Simply extract the tarball. Directory structure is described below :

\begin{lyxlist}{00.00.0000}
\item [\textbf{base}]base Curses abstractions.
\item [\textbf{doc}]documentation; this file in various formats.
\item [\textbf{spec}]API and constants wrapping classes.

\begin{lyxlist}{00.00.0000}
\item [\textbf{Clib}]c source files.
\item [\textbf{linux}]linux specific files.
\item [\textbf{windows}]windows specific file.s
\end{lyxlist}
\item [\textbf{utility}]some classes found useful to develop ECurses applications
like an event manager and a frame panel.
\item [\textbf{test}]small test projects.

\begin{lyxlist}{00.00.0000}
\item [\textbf{hello}]hello world !
\item [\textbf{pad}]exercise basic pad capabilities.
\item [\textbf{slk}]exercise soft label keys.
\item [\textbf{curses}]mimics the 'ncurses' standard test application.
\end{lyxlist}
\end{lyxlist}

\subsection{Get the appropriate Curses library}

Get and install the appropriate Curses library.

\begin{lyxlist}{00.00.0000}
\item [NCURSES]Version 4.2. http://www.gnu.org. Work on Unix/Linux platforms.
\item [PDCurses]Version 2.4. http://www.lightlink.com/hessling. Works on Windows 9X
and Windows NT. PDCurses also offer an X11 implementation for Unix, but it has
not been tested with the ECurses library.\\
!!WARNING : PDCurses has a bug. You should download sources, patch them following
directions given in the appendix, and recompile it.
\end{lyxlist}

\subsection{Compile support library}

C files are in the spec/Clib directory. The spec/\emph{<platform>} directory
contains ad hoc makefiles.

\begin{lyxlist}{00.00.0000}
\item [windows]A makefile (Makefile.vc.mak) is provided for MSVC compiler. Library
name is \emph{ecurses\_c.lib}.
\item [linux~]A makefile (Makefile) is provided for Linux .~ Type \char`\"{}make all\char`\"{}
in order to build the library \emph{libecurses\_c.a}.
\end{lyxlist}
This support library is necessary to compile and link ECurses programs .


\section{Usage}

This section gives an overview of what are the main abstractions of ECurses.


\subsection{Hello World !}

\begin{lyxcode}
{\small class}{\small \par}

{\small ~~~~HELLO\_WORLD}{\small \par}

~~~~

{\small inherit}{\small \par}

{\small ~~~~CURSES\_APPLICATION}{\small \par}

~~~~

{\small creation}{\small \par}

{\small ~~~~make}{\small \par}



{\small feature}{\small \par}

{\small ~~~~make~is}{\small \par}

{\small ~~~~~~~~do}{\small \par}

{\small ~~~~~~~~~~~~initialize}{\small \par}

{\small ~~~~~~~~~~~~standard\_window.move~(standard\_window.height~//~2,~}{\small \par}

{\small ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~standard\_window.width~//~2)}{\small \par}

{\small ~~~~~~~~~~~~standard\_window.put\_string~(\char`\"{}Hello,~World\char`\"{})}{\small \par}

{\small ~~~~~~~~~~~~standard\_window.move~(standard\_window.height-1,~0)}{\small \par}

{\small ~~~~~~~~~~~~standard\_window.put\_string~(\char`\"{}Press~any~key....\char`\"{})}{\small \par}

{\small ~~~~~~~~~~~~standard\_window.read\_character}{\small \par}

{\small ~~~~~~~~end}{\small \par}

~~~~

{\small end~-{}-~class~~HELLO\_WORLD}{\small \par}

~~~~~~~~
\end{lyxcode}
\begin{lyxlist}{00.00.0000}
\item [CURSES\_APPLICATION]must be inherited by an application's root class. The first
feature to be called must be one of the \emph{initialize}rs. Initialize is the
basic one. Others initialize Curses so that it provides soft label keys at the
bottom of the screen. An initialized ECurses application has a \emph{standard\_window},
a \emph{standard\_panel}, and \emph{soft\_label\_keys}.
\item [CURSES\_WINDOW]is the ``basic'' window class. It has many features which
cannot all be enumerated here. They are related to window creation or destruction,
positioning, update, status, cursor position, color setting, window input and
output, scrolling, line and border drawing, graphic attributes setting, subwindows
...
\end{lyxlist}

\subsection{Clusters description}


\subsubsection{Cluster BASE}

\begin{lyxlist}{00.00.0000}
\item [CURSES\_APPLICATION]Inherited by the application's root class. It provides
access to the standard (default) window and panel.
\item [CURSES\_WINDOW]Main abstraction. A window is a rectangular portion on the screen.
Internally, each window has a cell-memory where input/output operations occurs.
Actual screen i/o occur only when a window is \emph{refreshed}. A window can
have several subwindows. Each subwindow is a window of its own excepted that
it shares the same cell-memory as its parent : refreshing the parent refreshes
all the subwindows.
\item [CURSES\_ERROR\_HANDLING]Interface through which each low-level Curses call
transits. Provides handling of return codes.
\item [CURSES\_PAD]A pad is a rectangular area which is viewed through a view, i.e.
a smaller-than-the-pad rectangle. The view is displayed on the screen. A pad
can be larger than the terminal screen, but its view cannot.
\item [CURSES\_PANEL]A panel is a window which can be moved, hidden, shown. Panels
can be overlapped, while windows cannot easily.
\item [CURSES\_SOFT\_LABEL\_KEYS]Soft label keys, viewable at the bottom of the screen.
Several soft label keys organizations are available at initialization., but
they are limited to the capabilities of the library (PDCurses or NCurses) or
of the terminal.
\item [CURSES\_SYSTEM]Curses state an behaviour not related to a pad, panel or window. 
\item [SHARED\_CURSES\_SYSTEM]The ``Curses system'' is a singleton accessible to
all ECurses abstractions.
\end{lyxlist}

\subsubsection{Cluster~SPEC }

\begin{lyxlist}{00.00.0000}
\item [CURSES\_ATTRIBUTE\_CONSTANTS]Output attribute constants, like blink, underline.
\item [CURSES\_CHARACTER\_CONSTANTS]Constants reflecting  special terminal characters
like graphics blocks, etc...
\item [CURSES\_COLOR\_CONSTANTS]Color constants
\item [CURSES\_KEY\_CONSTANTS]Constants that reflect key codes like function keys,
cursor keys, keypad keys.
\item [CURSES\_{*}\_API]Those classes encapsulate the external features accessing
the various aspects of the Curses library.
\end{lyxlist}

\subsubsection{Cluster~UTILITY }

\begin{lyxlist}{00.00.0000}
\item [CURSES\_EVENT\_MANAGER]Basic event management logic. This class is intented
to be inherited and redefined.
\item [CURSES\_FRAME\_PANEL]Panel with a border and a clipped client area (borders
are not overwritten). 
\end{lyxlist}

\section{Questions and Answers}


\subsection{Status of the library}

It is the first publicly available version. Work still has to be done in various
directions like : assertions, documentation, tests. Still, it works...

ECurses has not been tested systematically. It has been used to develop some
nice terminal applications. Only those features necessary to theses applications
has been tested.

ECurses does not provide access to all the features of Curses. Applications
need to be developed to get interesting feedback and evolution of this library.


\subsection{C wrapping}

On the C side, Curses functions are implemented either as functions or as macros.
Library implementors make their own choice : a function implemented as a macro
in PDCurses is actually a function in NCurses. That's why we have chosen for
simple C wrapping rules applicable to both implementations.

We also wanted this wrapping to be as portable as possible among Eiffel compilers.

For each \char`\"{}function\char`\"{} F that can be called, a \emph{c\_ecurses\_F}
function is defined. This function basically cares that argument types are converted
the right way.

This mechanism is tedious (to type) but rather straightforward. External clauses
are simple, like defined in ETL (hope that SE and VE can handle it...) :

\begin{description}
\item [Eiffel]side (example)
\end{description}
\begin{lyxcode}
F~(w~:~POINTER;~y,~x~:~INTEGER):~INTEGER~is

external~\char`\"{}C\char`\"{}

alias~\char`\"{}c\_ecurses\_F\char`\"{}

end
\end{lyxcode}
\begin{description}
\item [C]side
\end{description}
\begin{lyxcode}
EIF\_INTEGER~c\_ecurses\_F~(EIF\_POINTER~w,~EIF\_INTEGER~y,~EIF\_INTEGER~x)

\{

~~~~return~(EIF\_INTEGER)~F((WINDOW{*})w,~(int)y,~~(int)~x);

\}
\end{lyxcode}
This C wrapping has been implemented for all CURSES\_{*}\_API classes.


\subsection{Portability}

There are two kind of portability :

\begin{enumerate}
\item Curses library portability
\item Eiffel portability
\end{enumerate}
ECurses has been tested with PDCurses on Windows and NCurses on Linux.

ECurses has been compiled using ISE Eiffel version 4.4 on Linux (Caldera 2.3,
kernel 2.210, glibc2.1, egcs 2.91.66), version 4.3 and 4.4 on Windows (MSVC
Compiler). The library should be portable without too much effort since no compiler
or library idiosyncrasy has been used. If some still remain, it is not intentional.

One of the possible difficulties remain in getting and passing external pointers,
for STRINGs for example.


\subsection{Console and X terminal emulations}

Curses applications are \emph{verrrry} sensible to the choice of good TERMCAPS
entries. Before saying ``it does not work'', verify your console or terminal
settings.

Some X terminal emulations won't give expected behaviour to your applications.
Some characters do not appear because they do not exist in the used font. Some
keys are not recognized because of an incorrect termcap entry.

Terminal emulators like \emph{xterm} or \emph{xterm-color} are known to work
best. Running your application in console mode can help you see how it should
work in your X terminal emulator.


\subsection{Reading from the keyboard}

A CURSES\_WINDOW object has features like \emph{read\_character} and \emph{read\_line}.
A read\_character always give two results : \emph{last\_character}, and \emph{last\_key},
which is an integer representing the key code.

If you want to test for key codes, do not forget to \emph{enable\_metacharacters}
on a window so that function or cursor keys end up in one code value. Otherwise,
you should get an escape sequence. 

If the keypad is to be used, use the feature \emph{enable\_keypad}.


\section{TODO}

\begin{itemize}
\item Make ECurses portable among Eiffel compilers. Port ECurses to SmallEiffel, and
use the GOBO library. 
\item Software contracts could be extended and better reflect features specifications. 
\item Documentation and sample programs should allow people to use ECurses, without
knowing much of Curses.
\end{itemize}

\section{Copyright}

Copyright (C) 1999 by Paul G. Crismer <pgcrism@attglobal.net> and Eric Fafchamps
<eric.fafchamps@win.be>.

This document and the ECurses library are licensed under the terms of the Eiffel
Forum Freeware License, version 1. Please refer to http://www.eiffel-forum.org.

\begin{quote}
Eiffel Forum Freeware License, version 1

Permission is hereby granted, without written agreement and without license
or royalty fees, to use, copy, modify and/or distribute this package, provided
that:

copyright notices are retained unchanged any distribution of this package, whether
modified or not, includes this file 

Permission is hereby also granted, without written agreement and without license
or royalty fees, to distribute binary programs which depend on this package,
provided that:

if the binary program depends on a modified version of this package, you must
publicly release the modified version of this package - for example by submitting
it to the Eiffel Forum archive (http://www.eiffel-forum.org/archive/) 

THIS PACKAGE IS PROVIDED \char`\"{}AS IS\char`\"{} AND WITHOUT WARRANTY. ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
EVENT SHALL THE AUTHORS BE LIABLE TO ANY PARTY FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES ARISING IN ANY WAY OUT OF THE USE
OF THIS PACKAGE.
\end{quote}

\section{Appendix - Patching PDCurses}

Let \$PDCURSES be the PDCurses installation directory.

Edit the file \$PDCURSES/panel/panel.c.

Function \_\_panel\_is\_linked do not return correct error codes. The first
return instruction should return OK, the second one should return ERR.

Here is the difference report of diff -p panel.c panel.c.old : The last lines
are the buggy ones.

\begin{lyxcode}
{\footnotesize {*}{*}{*}~panel.c~~~~~Sat~Jul~~3~15:49:40~1999}{\footnotesize \par}

{\footnotesize -{}-{}-~panel.c.old~Sat~Jul~~3~15:52:22~1999}{\footnotesize \par}

{\footnotesize {*}{*}{*}{*}{*}{*}{*}{*}{*}{*}{*}{*}{*}{*}{*}~register~PANEL~{*}pan2~=~\_\_bottom\_panel;}{\footnotesize \par}

{\footnotesize {*}{*}{*}~346,355~{*}{*}{*}{*}}{\footnotesize \par}

{\footnotesize ~~~~~~~~while(pan2)}{\footnotesize \par}

{\footnotesize ~~~~~~~~\{}{\footnotesize \par}

{\footnotesize ~~~~~~~~~~~~~~~~if(pan2~==~pan)}{\footnotesize \par}

{\footnotesize !~~~~~~~~~~~~~~~~~~~~~~~return(OK);}{\footnotesize \par}

{\footnotesize ~~~~~~~~~~~~~~~~pan2~=~pan2->above;}{\footnotesize \par}

{\footnotesize ~~~~~~~~\}}{\footnotesize \par}

{\footnotesize !~~~~~~~return(ERR);}{\footnotesize \par}

{\footnotesize ~~\}~~~~~/{*}~end~of~\_\_panel\_is\_linked~{*}/}{\footnotesize \par}

{\footnotesize ~~}{\footnotesize \par}

{\footnotesize ~~/{*}+-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-}{\footnotesize \par}

{\footnotesize -{}-{}-~346,355~-{}-{}-{}-}{\footnotesize \par}

{\footnotesize ~~~~~~~~while(pan2)}{\footnotesize \par}

{\footnotesize ~~~~~~~~\{}{\footnotesize \par}

{\footnotesize ~~~~~~~~~~~~~~~~if(pan2~==~pan)}{\footnotesize \par}

{\footnotesize !~~~~~~~~~~~~~~~~~~~~~~~return(1);}{\footnotesize \par}

{\footnotesize ~~~~~~~~~~~~~~~~pan2~=~pan2->above;}{\footnotesize \par}

{\footnotesize ~~~~~~~~\}}{\footnotesize \par}

{\footnotesize !~~~~~~~return(OK);}{\footnotesize \par}

{\footnotesize ~~\}~~~~~/{*}~end~of~\_\_panel\_is\_linked~{*}/}{\footnotesize \par}

{\footnotesize ~~}{\footnotesize \par}

{\footnotesize ~~/{*}+-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-{}-}{\footnotesize \par}
\end{lyxcode}
\begin{thebibliography}{}
\bibitem{1}``Writing programs with NCURSES'' by Eric S. Raymond and Zeyd M. Ben-Halim.\\
ftp://ftp.clark.net/pub/dickey/ncurses/ncurses-intro.html
\bibitem{2}man pages for NCurses
\bibitem{3}A Hacker's Guide to NCURSES by ? \\
ftp://ftp.clark.net/pub/dickey/ncurses/hackguide.html
\bibitem{4}NCurses FAQ\\
ftp://ftp.clark.net/pub/dickey/ncurses/ncurses.faq.html
\end{thebibliography}
\end{document}
